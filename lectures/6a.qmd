---
title: |
  Convolutional \
  Neural Networks
subtitle: "Image Classification with CIFAR"
format:
  revealjs:
    width: 1200
    scrollable: false
    include-in-header: "math.html"
    footer: m408.inqs.info/lectures/6a
    theme: [default, styles.scss]
    preview-links: true
    navigation-mode: vertical
    controls-layout: edges
    controls-tutorial: true
    slide-number: true
    pointer:
      pointerSize: 48
    incremental: false 
    chalkboard:
      theme: whiteboard
      chalk-width: 4
knitr:
  opts_chunk: 
    echo: true
    eval: false
    message: false
    warnings: false
    comment: "#>" 
    
revealjs-plugins:
  - pointer
  - verticator
  
filters: 
  - code-fullscreen
  - reveal-auto-agenda

editor: source
---

## R Packages

```{r}
# install.packages("tidyverse")
# install.packages("torch")
# install.packages("luz")
# install.packages("torchvision")

library(torch)
library(luz) # high-level interface for torch
library(tidyverse)
library(torchvision) # for datasets and image transformation


```

## Python Data

``` python
import torch
import torchvision
import torchvision.transforms as transforms

transform = transforms.Compose(
    [transforms.ToTensor(),
     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])

batch_size = 4

trainset = torchvision.datasets.CIFAR10(root='./data', train=True,
                                        download=True, transform=transform)
trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,
                                          shuffle=True, num_workers=2)

testset = torchvision.datasets.CIFAR10(root='./data', train=False,
                                       download=True, transform=transform)
testloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,
                                         shuffle=False, num_workers=2)

classes = ('plane', 'car', 'bird', 'cat',
           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')
```

# Image Classification

## Image Classification

Image classification is the process of having a computer analyzse an image and classify it with a selected category.

## Image Classification

What is this a picture of?

::: fragment
![](img/squirrel.jpg){fig-align="center" width="500"}
:::

## Image Classification

How did you know it was a squirrel?

# Convolutional Neural Networks

## Convolutional Neural Networks

Convolutional Neural Networks became popular in the 2010's with the success of image classification.

::: fragment
The idea is to mimic how a human mind will classify an image. (From an old understanding of neurobiology.)
:::

::: fragment
With the use of convolutional filters, a convolutional neural networks is trained by using a set of images that have been previously classfied.
:::

::: fragment
Once the network is trained, new images can be classified.
:::

## CNN

![Credit: ISLR2](img/islr2/Chapter10/10_6.jpg){fig-align="center"}

## Architecture

![](https://www.embedded.com/wp-content/uploads/2023/06/23026adi-cnn1_f03_thumb.jpg){fig-align="center"}


# Input Data

## Input Data

# Convolutional Filter

## Convolution Filter

A Convolution Filter will highlight certain features of an image.

::: fragment
The matching features will contain a large value.
:::

::: fragment
Dismatching features will contain a smaller value.
:::

## Convolution Filter

::: panel-tabset
## Image

$$
\left(
\begin{array}{ccc}
a & b & c \\
d & e & f \\
g & h & i \\
j & k & l 
\end{array}
\right)
$$

## Filter

$$
\left(
\begin{array}{cc}
\alpha & \beta \\
\gamma & \delta
\end{array}
\right)
$$

## Both

$$
\left(
\begin{array}{ccc}
a & b & c \\
d & e & f \\
g & h & i \\
j & k & l 
\end{array}
\right)
*
\left(
\begin{array}{cc}
\alpha & \beta \\
\gamma & \delta
\end{array}
\right)
$$

## Results

$$
\left(
\begin{array}{cc}
a\alpha + b\beta + d\gamma + w\delta & b\alpha + c\beta + e\gamma + f\delta \\
d\alpha + e\beta + g\gamma + h\delta & e\alpha + f\beta + h\gamma + i\delta \\
g\alpha + h\beta + j\gamma + k\delta & h\alpha + i\beta + k\gamma + l\delta
\end{array}
\right)
$$
:::

## Convolutional Layers

Convolution layers are a set of filters in a hidden layers. We can have $K$ layers that an image is passed through.

## Pooling Layers

The act of summarizing a large matrix to a smaller matrix.

## Max Pool

$$
\left[
\begin{array}{cccc}
1 & 3 & 9 & 5 \\
6 & 2 & 3 & 4 \\
1 & 0 & 6 & 4 \\
8 & 4 & 2 & 7
\end{array}
\right] \rightarrow
\left[
\begin{array}{cc}
6 & 9 \\
8 & 7
\end{array}
\right]
$$


## CIFAR Data

## Convolve Image

## Flattening

Once the images has been pooled to a select pixels or features. The images are flattened to a set of inputs.

::: fragment
These inputs are used to a traditional neural network to classify an image.
:::

## Training

The CNN is trained by supplying a set of pre-classified images.

::: fragment
The parameters in the convolution filters are estimated using standard techniques.
:::

# R CIFAR Data Analysis

## CIFAR Data

## Torch Packages in R

```{r}

library(torch)
library(luz) # high-level interface for torch
library(torchdatasets) # for datasets we are going to use
library(zeallot)
torch_manual_seed(13)

```

## CIFAR-10

